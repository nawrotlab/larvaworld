<!DOCTYPE html>
<html class="writer-html5" lang="python" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>larvaworld.lib.model.deb.deb &mdash; Python  documentation</title>
      <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../../" id="documentation_options" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
        <script src="../../../../../_static/sphinx_highlight.js"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../index.html" class="icon icon-home">
            Python
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../index.html">Welcome to the docs!</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Index:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../content/larvaworld/index.html">About larvaworld</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">Python</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">larvaworld.lib.model.deb.deb</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for larvaworld.lib.model.deb.deb</h1><div class="highlight"><pre>
<span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">DEB pipeline from literature</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">param</span>

<span class="kn">import</span> <span class="nn">larvaworld.lib.param.custom</span>
<span class="kn">from</span> <span class="nn">larvaworld.lib</span> <span class="kn">import</span> <span class="n">reg</span><span class="p">,</span> <span class="n">aux</span>
<span class="kn">from</span> <span class="nn">larvaworld.lib.aux</span> <span class="kn">import</span> <span class="n">nam</span>

<span class="kn">from</span> <span class="nn">larvaworld.lib.model</span> <span class="kn">import</span> <span class="n">deb</span>
<span class="kn">from</span> <span class="nn">larvaworld.lib.param</span> <span class="kn">import</span> <span class="n">Substrate</span><span class="p">,</span> <span class="n">NestedConf</span><span class="p">,</span> <span class="n">PositiveNumber</span><span class="p">,</span> <span class="n">PositiveInteger</span><span class="p">,</span> <span class="n">ClassAttr</span><span class="p">,</span> <span class="n">substrate_dict</span><span class="p">,</span> \
    <span class="n">Epoch</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Standard culture medium</span>
<span class="sd">50g Baker’s yeast; 100g sucrose; 16g agar; 0.1gKPO4; 8gKNaC4H4O6·4H2O; 0.5gNaCl; 0.5gMgCl2; and 0.5gFe2(SO4)3 per liter of tap water. </span>
<span class="sd">Larvae were reared from egg-hatch to mid- third-instar (96±2h post-hatch) in 25°C at densities of 100 larvae per 35ml of medium in 100mm⫻15mm Petri dishes</span>


<span class="sd">[1] K. R. Kaun, M. Chakaborty-Chatterjee, and M. B. Sokolowski, “Natural variation in plasticity of glucose homeostasis and food intake,” J. Exp. Biol., vol. 211, no. 19, pp. 3160–3166, 2008.</span>

<span class="sd">--&gt; 0.35 ml medium per larva for the 4 days</span>
<span class="sd">&#39;&#39;&#39;</span>



<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;DEB&#39;</span><span class="p">,</span>
    <span class="s1">&#39;deb_default&#39;</span><span class="p">,</span>
    <span class="s1">&#39;get_best_EEB&#39;</span><span class="p">,</span>
    <span class="s1">&#39;deb_sim&#39;</span><span class="p">,</span>
<span class="p">]</span>

<div class="viewcode-block" id="DEB"><a class="viewcode-back" href="../../../../../content/larvaworld/lib/model/deb/deb.html#larvaworld.lib.model.deb.deb.DEB">[docs]</a><span class="k">class</span> <span class="nc">DEB</span><span class="p">(</span><span class="n">NestedConf</span><span class="p">):</span>
    <span class="n">species</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="n">objects</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="s1">&#39;rover&#39;</span><span class="p">,</span> <span class="s1">&#39;sitter&#39;</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;phenotype&#39;</span><span class="p">,</span>
                             <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;The phenotype/species-specific fitted DEB model to use.&#39;</span><span class="p">)</span> <span class="c1"># Drosophila model by default</span>
    <span class="n">assimilation_mode</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="n">objects</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;gut&#39;</span><span class="p">,</span><span class="s1">&#39;sim&#39;</span><span class="p">,</span> <span class="s1">&#39;deb&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;assimilation mode&#39;</span><span class="p">,</span>
                             <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;The method used to calculate the DEB assimilation energy flow.&#39;</span><span class="p">)</span>
    <span class="n">starvation_strategy</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;Whether starvation strategy is active&#39;</span><span class="p">)</span>
    <span class="n">aging</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;Whether aging is active&#39;</span><span class="p">)</span>
    <span class="n">hunger_as_EEB</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;Whether the DEB-generated hunger drive informs the exploration-exploitation balance.&#39;</span><span class="p">)</span>
    <span class="n">use_gut</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;Whether to use the gut module.&#39;</span><span class="p">)</span>
    <span class="n">hunger_gain</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Magnitude</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;hunger sensitivity to reserve reduction&#39;</span><span class="p">,</span>
                                  <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;The sensitivy of the hunger drive in deviations of the DEB reserve density.&#39;</span><span class="p">)</span>
    <span class="n">hours_as_larva</span> <span class="o">=</span> <span class="n">PositiveNumber</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;The age since eclosion&#39;</span><span class="p">)</span>
    <span class="n">steps_per_day</span> <span class="o">=</span> <span class="n">PositiveInteger</span><span class="p">(</span><span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;How many iterations of the model per day&#39;</span><span class="p">)</span>
    <span class="n">substrate</span> <span class="o">=</span> <span class="n">ClassAttr</span><span class="p">(</span><span class="n">Substrate</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;The substrate where the agent feeds&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;DEB model&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mf">298.15</span><span class="p">,</span> <span class="n">eb</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                 <span class="n">print_output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">save_to</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">V_bite</span><span class="o">=</span><span class="mf">0.0005</span><span class="p">,</span> <span class="n">base_hunger</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                 <span class="n">simulation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">intermitter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gut_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Drosophila model by default</span>

        <span class="c1"># with open(reg.Path[&quot;DEB_MODS&quot;][species]) as tfp:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">reg</span><span class="o">.</span><span class="n">ROOT_DIR</span><span class="si">}</span><span class="s1">/lib/model/deb/models/deb_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="si">}</span><span class="s1">.csv&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tfp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">species_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">tfp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_dict</span><span class="p">)</span>



        <span class="bp">self</span><span class="o">.</span><span class="n">set_intermitter</span><span class="p">(</span><span class="n">intermitter</span><span class="p">,</span> <span class="n">base_hunger</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">T</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L0</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hours_as_larva</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cv</span> <span class="o">=</span> <span class="n">cv</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eb</span> <span class="o">=</span> <span class="n">eb</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_to</span> <span class="o">=</span> <span class="n">save_to</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_output</span> <span class="o">=</span> <span class="n">print_output</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span> <span class="o">=</span> <span class="n">simulation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epochs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epoch_fs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epoch_qs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_file</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Larva stage flags</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stage</span> <span class="o">=</span> <span class="s1">&#39;embryo&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alive</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Stage duration parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">birth_time_in_hours</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pupation_time_in_hours</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emergence_time_in_hours</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">death_time_in_hours</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">derived_pars</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">E_H</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">E_R</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L0</span> <span class="o">**</span> <span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deb_p_A</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_p_A</span> <span class="o">=</span> <span class="mi">0</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">base_f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">substrate</span><span class="o">.</span><span class="n">get_f</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_f</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">V_bite</span> <span class="o">=</span> <span class="n">V_bite</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps_per_day</span>
        <span class="k">if</span> <span class="n">gut_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gut_params</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">get_null</span><span class="p">(</span><span class="s1">&#39;gut&#39;</span><span class="p">)</span>
            <span class="c1"># gut_params=null_dict(&#39;gut_params&#39;)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gut</span> <span class="o">=</span> <span class="n">deb</span><span class="o">.</span><span class="n">Gut</span><span class="p">(</span><span class="n">deb</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_dict</span><span class="o">=</span><span class="n">save_dict</span><span class="p">,</span> <span class="o">**</span><span class="n">gut_params</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_gut</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_steps_per_day</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">steps_per_day</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_embryo_stage</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predict_larva_stage</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">base_f</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_dict</span><span class="p">()</span> <span class="k">if</span> <span class="n">save_dict</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Lw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">del_M</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">L</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>

<div class="viewcode-block" id="DEB.scale_time"><a class="viewcode-back" href="../../../../../content/larvaworld/lib/model/deb/deb.html#larvaworld.lib.model.deb.deb.DEB.scale_time">[docs]</a>    <span class="k">def</span> <span class="nf">scale_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">F_m_dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">F_m</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_M_dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_M</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_T_dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_T</span> <span class="o">*</span> <span class="n">dt</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_T</span> <span class="o">!=</span> <span class="mf">0.0</span> <span class="k">else</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_J_dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_J</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h_a_dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h_a</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">**</span> <span class="mi">2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">p_Am_dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_Am</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_Amm_dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_Amm</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">J_X_Amm_dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">J_X_Amm</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">J_E_Amm_dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">J_E_Amm</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_E_dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_E</span> <span class="o">*</span> <span class="n">dt</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gut</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gut</span><span class="o">.</span><span class="n">get_residence_ticks</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">J_X_A_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gut</span><span class="o">.</span><span class="n">residence_ticks</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">J_X_A</span></div>

<div class="viewcode-block" id="DEB.set_intermitter"><a class="viewcode-back" href="../../../../../content/larvaworld/lib/model/deb/deb.html#larvaworld.lib.model.deb.deb.DEB.set_intermitter">[docs]</a>    <span class="k">def</span> <span class="nf">set_intermitter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intermitter</span><span class="p">,</span> <span class="n">base_hunger</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intermitter</span> <span class="o">=</span> <span class="n">intermitter</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hunger_as_EEB</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">intermitter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">base_hunger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intermitter</span><span class="o">.</span><span class="n">base_EEB</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_hunger</span> <span class="o">=</span> <span class="n">base_hunger</span></div>

<div class="viewcode-block" id="DEB.set_steps_per_day"><a class="viewcode-back" href="../../../../../content/larvaworld/lib/model/deb/deb.html#larvaworld.lib.model.deb.deb.DEB.set_steps_per_day">[docs]</a>    <span class="k">def</span> <span class="nf">set_steps_per_day</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">steps_per_day</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps_per_day</span> <span class="o">=</span> <span class="n">steps_per_day</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">steps_per_day</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale_time</span><span class="p">()</span></div>

<div class="viewcode-block" id="DEB.derived_pars"><a class="viewcode-back" href="../../../../../content/larvaworld/lib/model/deb/deb.html#larvaworld.lib.model.deb.deb.DEB.derived_pars">[docs]</a>    <span class="k">def</span> <span class="nf">derived_pars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">kap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kap</span>
        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span>
        <span class="n">p_Am</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_Am</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_M</span> <span class="o">/</span> <span class="n">kap</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">J_E_Am</span> <span class="o">=</span> <span class="n">p_Am</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu_E</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">J_X_Am</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">J_E_Am</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_E_X</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_Xm</span> <span class="o">=</span> <span class="n">p_Am</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">kap_X</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">K</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">J_X_Am</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">F_m</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">E_M</span> <span class="o">=</span> <span class="n">p_Am</span> <span class="o">/</span> <span class="n">v</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">E_V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu_V</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_V</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_V</span>
        <span class="n">k_M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_M</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">E_G</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E_G</span> <span class="o">/</span> <span class="p">(</span><span class="n">kap</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">E_M</span><span class="p">)</span>
        <span class="n">ii</span> <span class="o">=</span> <span class="n">g</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">k_M</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">/</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">kap</span><span class="p">)</span> <span class="o">*</span> <span class="n">v</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_J</span> <span class="o">/</span> <span class="n">k_M</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">U_Hb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E_Hb</span> <span class="o">/</span> <span class="n">p_Am</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vHb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">U_Hb</span> <span class="o">*</span> <span class="n">ii</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">U_He</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E_He</span> <span class="o">/</span> <span class="n">p_Am</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vHe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">U_He</span> <span class="o">*</span> <span class="n">ii</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Lm</span> <span class="o">=</span> <span class="n">v</span> <span class="o">/</span> <span class="p">(</span><span class="n">g</span> <span class="o">*</span> <span class="n">k_M</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T_factor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T_A</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_ref</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_A</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">);</span>  <span class="c1"># Arrhenius factor</span>
        <span class="c1"># v**-1*L=e*E_G/(g*pM)</span>
        <span class="n">lb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lb</span> <span class="o">=</span> <span class="n">deb</span><span class="o">.</span><span class="n">get_lb</span><span class="p">(</span><span class="n">eb</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">eb</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">species_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">E0</span> <span class="o">=</span> <span class="n">deb</span><span class="o">.</span><span class="n">get_E0</span><span class="p">(</span><span class="n">eb</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">eb</span><span class="p">,</span><span class="n">lb</span><span class="o">=</span><span class="n">lb</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">species_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">E_Rm</span> <span class="o">=</span> <span class="n">deb</span><span class="o">.</span><span class="n">get_E_Rm</span><span class="p">(</span><span class="n">lb</span><span class="o">=</span><span class="n">lb</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">species_dict</span><span class="p">)</span>

        <span class="n">Lb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Lb</span> <span class="o">=</span> <span class="n">lb</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Lm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Lwb</span> <span class="o">=</span> <span class="n">Lb</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">del_M</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tau_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tau_b</span><span class="p">(</span><span class="n">eb</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">eb</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_b</span> <span class="o">/</span> <span class="n">k_M</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_factor</span>
        <span class="c1"># print(Lb)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_E</span> <span class="o">=</span> <span class="n">v</span> <span class="o">/</span> <span class="n">Lb</span>

        <span class="c1"># For the larva the volume specific max assimilation rate p_Amm is used instead of the surface-specific p_Am</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_Amm</span> <span class="o">=</span> <span class="n">p_Am</span> <span class="o">/</span> <span class="n">Lb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">J_X_Amm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">J_X_Am</span> <span class="o">/</span> <span class="n">Lb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">J_E_Amm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">J_E_Am</span> <span class="o">/</span> <span class="n">Lb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">F_mm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">F_m</span> <span class="o">/</span> <span class="n">Lb</span>

        <span class="c1"># DEB textbook p.91</span>
        <span class="c1"># self.y_VE = (self.d_V / self.w_V)*self.mu_E/E_G</span>
        <span class="c1"># self.J_E_Am = self.p_Am/self.mu_E</span>


        <span class="c1"># self.U0 = self.uE0 * v ** 2 / g ** 2 / k_M ** 3</span>
        <span class="c1"># self.E0 = self.U0 * p_Am</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ww0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_E</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu_E</span>  <span class="c1"># g, initial wet weight</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">v_Rm</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">lb</span> <span class="o">/</span> <span class="n">g</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">lb</span><span class="p">)</span>  <span class="c1"># scaled max reprod buffer density</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_Rj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_j</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_Rm</span>  <span class="c1"># scaled reprod buffer density at pupation</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_output</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;------------------Egg------------------&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Reserve energy  (mJ) :       </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="mi">1000</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">E0</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Wet weight      (mg) :       </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">1000</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ww0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DEB.hex_model"><a class="viewcode-back" href="../../../../../content/larvaworld/lib/model/deb/deb.html#larvaworld.lib.model.deb.deb.DEB.hex_model">[docs]</a>    <span class="k">def</span> <span class="nf">hex_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># p.161    [1] S. a. L. M. Kooijman, “Comments on Dynamic Energy Budget theory,” Changes, 2010.</span>
        <span class="c1"># For the larva stage</span>
        <span class="c1"># self.r = self.g * self.k_M * (self.e/self.lb -1)/(self.e+self.g) # growth rate at  constant food where e=f</span>
        <span class="c1"># self.k_E = self.v/self.Lb # Reserve turnover</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="DEB.get_tau_b"><a class="viewcode-back" href="../../../../../content/larvaworld/lib/model/deb/deb.html#larvaworld.lib.model.deb.deb.DEB.get_tau_b">[docs]</a>    <span class="k">def</span> <span class="nf">get_tau_b</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eb</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">quad</span>
        <span class="k">def</span> <span class="nf">get_tb</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ab</span><span class="p">,</span> <span class="n">xb</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">x</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">ab</span> <span class="o">-</span> <span class="n">deb</span><span class="o">.</span><span class="n">beta0</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xb</span><span class="p">))</span>

        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span>
        <span class="n">xb</span> <span class="o">=</span> <span class="n">g</span> <span class="o">/</span> <span class="p">(</span><span class="n">eb</span> <span class="o">+</span> <span class="n">g</span><span class="p">)</span>
        <span class="n">ab</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">g</span> <span class="o">*</span> <span class="n">xb</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">lb</span>
        <span class="k">return</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">quad</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">get_tb</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">1e-15</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">xb</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">ab</span><span class="p">,</span> <span class="n">xb</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span></div>


<div class="viewcode-block" id="DEB.predict_larva_stage"><a class="viewcode-back" href="../../../../../content/larvaworld/lib/model/deb/deb.html#larvaworld.lib.model.deb.deb.DEB.predict_larva_stage">[docs]</a>    <span class="k">def</span> <span class="nf">predict_larva_stage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span>
        <span class="n">lb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lb</span>
        <span class="n">c1</span> <span class="o">=</span> <span class="n">f</span> <span class="o">/</span> <span class="n">g</span> <span class="o">*</span> <span class="p">(</span><span class="n">g</span> <span class="o">+</span> <span class="n">lb</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">f</span> <span class="o">-</span> <span class="n">lb</span><span class="p">)</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">vHb</span> <span class="o">/</span> <span class="n">lb</span> <span class="o">**</span> <span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rho_j</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span> <span class="o">/</span> <span class="n">lb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">f</span> <span class="o">/</span> <span class="n">g</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># scaled specific growth rate of larva</span>

        <span class="k">def</span> <span class="nf">get_tj</span><span class="p">(</span><span class="n">tau_j</span><span class="p">):</span>
            <span class="n">ert</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span> <span class="n">tau_j</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_j</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_Rj</span> <span class="o">-</span> <span class="n">c1</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">ert</span><span class="p">)</span> <span class="o">+</span> <span class="n">c2</span> <span class="o">*</span> <span class="n">tau_j</span> <span class="o">*</span> <span class="n">ert</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tau_j</span> <span class="o">=</span> <span class="n">deb</span><span class="o">.</span><span class="n">simplex</span><span class="p">(</span><span class="n">get_tj</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lj</span> <span class="o">=</span> <span class="n">lb</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tau_j</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_j</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_j</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_M</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Lj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lj</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Lm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Lwj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Lj</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">del_M</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">E_Rm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_Rm</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">kap</span><span class="p">)</span> <span class="o">*</span> <span class="n">g</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">E_M</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Lj</span> <span class="o">**</span> <span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">E_Rj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E_Rm</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_j</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">E_eggs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E_Rm</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">kap_R</span></div>

<div class="viewcode-block" id="DEB.predict_pupa_stage"><a class="viewcode-back" href="../../../../../content/larvaworld/lib/model/deb/deb.html#larvaworld.lib.model.deb.deb.DEB.predict_pupa_stage">[docs]</a>    <span class="k">def</span> <span class="nf">predict_pupa_stage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">solve_ivp</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span>
        <span class="n">k_M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_M</span>

        <span class="k">def</span> <span class="nf">emergence</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">luEvH</span><span class="p">,</span> <span class="n">terminal</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vHe</span> <span class="o">-</span> <span class="n">luEvH</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">get_te</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">luEvH</span><span class="p">):</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">luEvH</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">u_E</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">,</span> <span class="n">luEvH</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">ii</span> <span class="o">=</span> <span class="n">u_E</span> <span class="o">+</span> <span class="n">l</span> <span class="o">**</span> <span class="mi">3</span>
            <span class="n">dl</span> <span class="o">=</span> <span class="p">(</span><span class="n">g</span> <span class="o">*</span> <span class="n">u_E</span> <span class="o">-</span> <span class="n">l</span> <span class="o">**</span> <span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="n">ii</span> <span class="o">/</span> <span class="mi">3</span>
            <span class="n">du_E</span> <span class="o">=</span> <span class="o">-</span> <span class="n">u_E</span> <span class="o">*</span> <span class="n">l</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">g</span> <span class="o">+</span> <span class="n">l</span><span class="p">)</span> <span class="o">/</span> <span class="n">ii</span>
            <span class="n">dv_H</span> <span class="o">=</span> <span class="o">-</span> <span class="n">du_E</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="n">luEvH</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">dl</span><span class="p">,</span> <span class="n">du_E</span><span class="p">,</span> <span class="n">dv_H</span><span class="p">]</span>  <span class="c1"># pack output</span>

        <span class="n">sol</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span><span class="n">fun</span><span class="o">=</span><span class="n">get_te</span><span class="p">,</span> <span class="n">t_span</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">y0</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uEj</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">events</span><span class="o">=</span><span class="n">emergence</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tau_e</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">t_events</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">le</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uEe</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">y_events</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][:</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_e</span> <span class="o">/</span> <span class="n">k_M</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Le</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">le</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Lm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Lwe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Le</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">del_M</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uEe</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">g</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">k_M</span> <span class="o">**</span> <span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ee</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ue</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_Am</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Wwe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_Ww</span><span class="p">(</span><span class="n">V</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Le</span> <span class="o">**</span> <span class="mi">3</span><span class="p">,</span> <span class="n">E</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Ee</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">E_Rj</span><span class="p">)</span>  <span class="c1"># g, wet weight at emergence</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Le</span> <span class="o">**</span> <span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ee</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">E_H</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E_He</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">emergence_time_in_hours</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pupation_time_in_hours</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_e</span> <span class="o">*</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stage</span> <span class="o">=</span> <span class="s1">&#39;imago&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_e</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_output</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-------------Pupa stage-------------&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Duration         (d) :      </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_e</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-------------Emergence--------------&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Wet weight      (mg) :      </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Wwe</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Physical length (mm) :      </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Lwe</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DEB.time_to_death_by_starvation"><a class="viewcode-back" href="../../../../../content/larvaworld/lib/model/deb/deb.html#larvaworld.lib.model.deb.deb.DEB.time_to_death_by_starvation">[docs]</a>    <span class="k">def</span> <span class="nf">time_to_death_by_starvation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kap</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="DEB.predict_imago_stage"><a class="viewcode-back" href="../../../../../content/larvaworld/lib/model/deb/deb.html#larvaworld.lib.model.deb.deb.DEB.predict_imago_stage">[docs]</a>    <span class="k">def</span> <span class="nf">predict_imago_stage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="c1"># if np.abs(self.sG) &lt; 1e-10:</span>
        <span class="c1">#     self.sG = 1e-10</span>
        <span class="c1"># self.uh_a =self.h_a/ self.k_M ** 2 # scaled Weibull aging coefficient</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_T</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p_M</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Lm</span><span class="p">)</span>  <span class="c1"># scaled heating length {p_T}/[p_M]Lm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">li</span> <span class="o">=</span> <span class="n">f</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lT</span><span class="p">;</span>
        <span class="c1"># self.hW3 = self.ha * f * self.g/ 6/ self.li</span>
        <span class="c1"># self.hW = self.hW3**(1/3) # scaled Weibull aging rate</span>
        <span class="c1"># self.hG = self.sG * f * self.g * self.li**2</span>
        <span class="c1"># self.hG3 = self.hG**3;     # scaled Gompertz aging rate</span>
        <span class="c1"># self.tG = self.hG/ self.hW</span>
        <span class="c1"># self.tG3 = self.hG3/ self.hW3 # scaled Gompertz aging rate</span>
        <span class="c1"># # self.tau_m = sol.t_events[0][0]</span>
        <span class="c1"># # self.lm, self.uEm=sol.y_events[0][0][:2]</span>
        <span class="c1"># self.t_m = self.tau_m / self.k_M / self.T_factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Li</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">li</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Lm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Lwi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Li</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">del_M</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ui</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uEi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_M</span> <span class="o">**</span> <span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ei</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ui</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_Am</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Wwi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_Ww</span><span class="p">(</span><span class="n">V</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Li</span> <span class="o">**</span> <span class="mi">3</span><span class="p">,</span> <span class="n">E</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Ei</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">E_Rj</span><span class="p">)</span>  <span class="c1"># g, imago wet weight</span>
        <span class="c1"># self.age = self.t_m</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Li</span> <span class="o">**</span> <span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ei</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_output</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-------------Imago stage-------------&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Duration         (d) :      </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_i_cor</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---------------Emergence---------------&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Wet weight      (mg) :      </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Wwi</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Physical length (mm) :      </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Lwi</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DEB.run_embryo_stage"><a class="viewcode-back" href="../../../../../content/larvaworld/lib/model/deb/deb.html#larvaworld.lib.model.deb.deb.DEB.run_embryo_stage">[docs]</a>    <span class="k">def</span> <span class="nf">run_embryo_stage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">dt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span>

        <span class="n">kap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kap</span>
        <span class="n">E_G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E_G</span>

        <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">E_H</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">E_Hb</span><span class="p">:</span>
            <span class="c1"># This is in e/t and below needs to be volume-specific</span>
            <span class="n">p_S</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_M_dt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_T_dt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">**</span> <span class="p">(</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">p_C</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">*</span> <span class="p">(</span><span class="n">E_G</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_dt</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">p_S</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">kap</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">+</span> <span class="n">E_G</span><span class="p">)</span>
            <span class="n">p_G</span> <span class="o">=</span> <span class="n">kap</span> <span class="o">*</span> <span class="n">p_C</span> <span class="o">-</span> <span class="n">p_S</span>
            <span class="n">p_J</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_J_dt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">E_H</span>
            <span class="n">p_R</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">kap</span><span class="p">)</span> <span class="o">*</span> <span class="n">p_C</span> <span class="o">-</span> <span class="n">p_J</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">-=</span> <span class="n">p_C</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">+=</span> <span class="n">p_G</span> <span class="o">/</span> <span class="n">E_G</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">E_H</span> <span class="o">+=</span> <span class="n">p_R</span>
            <span class="n">t</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Eb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span>
        <span class="n">L_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">Lw_b</span> <span class="o">=</span> <span class="n">L_b</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">del_M</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Wwb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_Ww</span><span class="p">(</span><span class="n">V</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Lb</span> <span class="o">**</span> <span class="mi">3</span><span class="p">,</span> <span class="n">E</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Eb</span><span class="p">)</span>  <span class="c1"># g, wet weight at birth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">birth_time_in_hours</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_b</span> <span class="o">*</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_start</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">birth_time_in_hours</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stage</span> <span class="o">=</span> <span class="s1">&#39;larva&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_b</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_output</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-------------Embryo stage-------------&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Duration         (d) :      predicted </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_b</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s1"> VS computed </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----------------Birth----------------&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Wet weight      (mg) :      </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Wwb</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Physical length (mm) :      predicted </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Lwb</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s1"> VS computed </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Lw_b</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DEB.run_larva_stage"><a class="viewcode-back" href="../../../../../content/larvaworld/lib/model/deb/deb.html#larvaworld.lib.model.deb.deb.DEB.run_larva_stage">[docs]</a>    <span class="k">def</span> <span class="nf">run_larva_stage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">dt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span>
        <span class="n">kap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kap</span>
        <span class="n">E_G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E_G</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span>
        <span class="n">del_M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">del_M</span>

        <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">E_R</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">E_Rj</span><span class="p">:</span>
            <span class="n">p_A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_Amm_dt</span> <span class="o">*</span> <span class="n">f</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span>
            <span class="n">p_S</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_M_dt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span>
            <span class="n">p_C</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">*</span> <span class="p">(</span><span class="n">E_G</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_E_dt</span> <span class="o">+</span> <span class="n">p_S</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">kap</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">+</span> <span class="n">E_G</span><span class="p">)</span>
            <span class="n">p_G</span> <span class="o">=</span> <span class="n">kap</span> <span class="o">*</span> <span class="n">p_C</span> <span class="o">-</span> <span class="n">p_S</span>
            <span class="n">p_J</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_J_dt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">E_Hb</span>
            <span class="n">p_R</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">kap</span><span class="p">)</span> <span class="o">*</span> <span class="n">p_C</span> <span class="o">-</span> <span class="n">p_J</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">+=</span> <span class="p">(</span><span class="n">p_A</span> <span class="o">-</span> <span class="n">p_C</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">+=</span> <span class="n">p_G</span> <span class="o">/</span> <span class="n">E_G</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">E_R</span> <span class="o">+=</span> <span class="n">p_R</span>
            <span class="n">t</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="n">Lw_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="n">del_M</span>
        <span class="n">Ej</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ej</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Uj</span> <span class="o">=</span> <span class="n">Ej</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_Am</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uEj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lj</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kap</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">kap_V</span> <span class="o">+</span> <span class="n">f</span> <span class="o">/</span> <span class="n">g</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Wwj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_Ww</span><span class="p">(</span><span class="n">V</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Lj</span> <span class="o">**</span> <span class="mi">3</span><span class="p">,</span>
                                   <span class="n">E</span><span class="o">=</span><span class="n">Ej</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">E_Rj</span><span class="p">)</span>  <span class="c1"># g, wet weight at pupation, including reprod buffer</span>
        <span class="c1"># self.Wwj = self.Lj**3 * (1 + f * self.w_V) # g, wet weight at pupation, excluding reprod buffer at pupation</span>
        <span class="c1"># self.Wwj += self.E_Rj * self.w_E/ self.mu_E/ self.d_E # g, wet weight including reprod buffer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pupation_time_in_hours</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">birth_time_in_hours</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">t</span> <span class="o">*</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stage</span> <span class="o">=</span> <span class="s1">&#39;pupa&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_output</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-------------Larva stage-------------&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Duration         (d) :      predicted </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_j</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s1"> VS computed </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---------------Pupation---------------&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Wet weight      (mg) :      </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Wwj</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Physical length (mm) :      predicted </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Lwj</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s1"> VS computed </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Lw_j</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DEB.compute_hunger"><a class="viewcode-back" href="../../../../../content/larvaworld/lib/model/deb/deb.html#larvaworld.lib.model.deb.deb.DEB.compute_hunger">[docs]</a>    <span class="k">def</span> <span class="nf">compute_hunger</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_hunger</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">hunger_gain</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">),</span> <span class="n">a_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">a_max</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">h</span></div>

<div class="viewcode-block" id="DEB.run"><a class="viewcode-back" href="../../../../../content/larvaworld/lib/model/deb/deb.html#larvaworld.lib.model.deb.deb.DEB.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">X_V</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">assimilation_mode</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_f</span>
        <span class="k">if</span> <span class="n">assimilation_mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">assimilation_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assimilation_mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">f</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span>
        <span class="n">kap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kap</span>
        <span class="n">E_G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E_G</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">E_R</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">E_Rj</span><span class="p">:</span>
            <span class="n">p_A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_p_A</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">assimilation_mode</span><span class="o">=</span><span class="n">assimilation_mode</span><span class="p">,</span> <span class="n">X_V</span><span class="o">=</span><span class="n">X_V</span><span class="p">)</span>
            <span class="n">p_S</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_M_dt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span>
            <span class="n">p_C</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">*</span> <span class="p">(</span><span class="n">E_G</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_E_dt</span> <span class="o">+</span> <span class="n">p_S</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">kap</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">+</span> <span class="n">E_G</span><span class="p">)</span>
            <span class="n">p_G</span> <span class="o">=</span> <span class="n">kap</span> <span class="o">*</span> <span class="n">p_C</span> <span class="o">-</span> <span class="n">p_S</span>
            <span class="n">p_J</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_J_dt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">E_Hb</span>
            <span class="n">p_R</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">kap</span><span class="p">)</span> <span class="o">*</span> <span class="n">p_C</span> <span class="o">-</span> <span class="n">p_J</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">+=</span> <span class="p">(</span><span class="n">p_A</span> <span class="o">-</span> <span class="n">p_C</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">+=</span> <span class="n">p_G</span> <span class="o">/</span> <span class="n">E_G</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">E_R</span> <span class="o">+=</span> <span class="n">p_R</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_hunger</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage</span> <span class="o">==</span> <span class="s1">&#39;larva&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pupation_time_in_hours</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">*</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stage</span> <span class="o">=</span> <span class="s1">&#39;pupa&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_dict</span><span class="p">()</span></div>

<div class="viewcode-block" id="DEB.update_hunger"><a class="viewcode-back" href="../../../../../content/larvaworld/lib/model/deb/deb.html#larvaworld.lib.model.deb.deb.DEB.update_hunger">[docs]</a>    <span class="k">def</span> <span class="nf">update_hunger</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hunger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_hunger</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hunger_as_EEB</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">intermitter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">intermitter</span><span class="o">.</span><span class="n">base_EEB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hunger</span></div>

<div class="viewcode-block" id="DEB.die"><a class="viewcode-back" href="../../../../../content/larvaworld/lib/model/deb/deb.html#larvaworld.lib.model.deb.deb.DEB.die">[docs]</a>    <span class="k">def</span> <span class="nf">die</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alive</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">death_time_in_hours</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">*</span> <span class="mi">24</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_output</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Dead after </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">age</span><span class="si">}</span><span class="s1"> days&#39;</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">J_X_A</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">J_X_Amm</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_f</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">F</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># Vol specific filtering rate (cm**3/(d*cm**3) -&gt; vol of environment/vol of individual*day</span>
        <span class="c1"># F = self.F_mm * self.K/(self.K + self.substrate.X)</span>
        <span class="n">F</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">F_mm</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">substrate</span><span class="o">.</span><span class="n">X</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">J_X_Amm</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1</span>
        <span class="c1"># F = (self.F_mm ** -1 + self.substrate.X * self.J_X_Amm ** -1) ** -1</span>
        <span class="k">return</span> <span class="n">F</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fr_feed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">F</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_bite</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_factor</span>
        <span class="n">freq</span> <span class="o">/=</span> <span class="p">(</span><span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">freq</span>

<div class="viewcode-block" id="DEB.compute_Ww"><a class="viewcode-back" href="../../../../../content/larvaworld/lib/model/deb/deb.html#larvaworld.lib.model.deb.deb.DEB.compute_Ww">[docs]</a>    <span class="k">def</span> <span class="nf">compute_Ww</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">V</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">E</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">V</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span>
        <span class="k">if</span> <span class="n">E</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">E_R</span>
        <span class="k">return</span> <span class="n">V</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_V</span> <span class="o">+</span> <span class="n">E</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_E</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu_E</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Ww</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_V</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">E_R</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_E</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu_E</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">e</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">E_M</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Vw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Em</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_Am</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span>
        <span class="n">omegaV</span> <span class="o">=</span> <span class="n">Em</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_E</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_E</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu_E</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">omegaV</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">)</span>

<div class="viewcode-block" id="DEB.grow_larva"><a class="viewcode-back" href="../../../../../content/larvaworld/lib/model/deb/deb.html#larvaworld.lib.model.deb.deb.DEB.grow_larva">[docs]</a>    <span class="k">def</span> <span class="nf">grow_larva</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">epochs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">tb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">birth_time_in_hours</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epoch_fs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epoch_qs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epochs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">ep</span> <span class="ow">in</span> <span class="n">epochs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1">#print(idx,ep)</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">ep</span><span class="p">[</span><span class="s1">&#39;substrate&#39;</span><span class="p">][</span><span class="s1">&#39;quality&#39;</span><span class="p">]</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">deb</span><span class="o">.</span><span class="n">Substrate</span><span class="p">(</span><span class="o">**</span><span class="n">ep</span><span class="p">[</span><span class="s1">&#39;substrate&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">get_f</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">)</span>
            <span class="n">c</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;assimilation_mode&#39;</span><span class="p">:</span> <span class="s1">&#39;sim&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">}</span>
            <span class="n">t0</span><span class="p">,</span><span class="n">t1</span><span class="o">=</span><span class="n">ep</span><span class="p">[</span><span class="s1">&#39;age_range&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">t1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage</span> <span class="o">==</span> <span class="s1">&#39;larva&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="o">**</span><span class="n">c</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">N</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">steps_per_day</span> <span class="o">/</span> <span class="mi">24</span> <span class="o">*</span> <span class="p">(</span><span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage</span> <span class="o">==</span> <span class="s1">&#39;larva&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="o">**</span><span class="n">c</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">epoch_fs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">epoch_qs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">epochs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">[</span><span class="n">t0</span> <span class="o">+</span> <span class="n">tb</span><span class="p">,</span> <span class="n">t1</span> <span class="o">+</span> <span class="n">tb</span> <span class="k">if</span> <span class="n">t1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">pupation_time_in_hours</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hours_as_larva</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">-</span> <span class="n">tb</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gut</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gut</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pupation_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">E_R</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">E_Rj</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">EEB</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">intermitter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">intermitter</span><span class="o">.</span><span class="n">EEB</span>

<div class="viewcode-block" id="DEB.init_dict"><a class="viewcode-back" href="../../../../../content/larvaworld/lib/model/deb/deb.html#larvaworld.lib.model.deb.deb.DEB.init_dict">[docs]</a>    <span class="k">def</span> <span class="nf">init_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_keys</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;age&#39;</span><span class="p">,</span>
            <span class="s1">&#39;mass&#39;</span><span class="p">,</span>
            <span class="s1">&#39;length&#39;</span><span class="p">,</span>
            <span class="s1">&#39;reserve&#39;</span><span class="p">,</span>
            <span class="s1">&#39;reserve_density&#39;</span><span class="p">,</span>
            <span class="s1">&#39;hunger&#39;</span><span class="p">,</span>
            <span class="s1">&#39;pupation_buffer&#39;</span><span class="p">,</span>
            <span class="s1">&#39;f&#39;</span><span class="p">,</span>
            <span class="s1">&#39;deb_p_A&#39;</span><span class="p">,</span>
            <span class="s1">&#39;sim_p_A&#39;</span><span class="p">,</span>
            <span class="s1">&#39;EEB&#39;</span>
        <span class="p">]</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_keys</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">d</span></div>

<div class="viewcode-block" id="DEB.update_dict"><a class="viewcode-back" href="../../../../../content/larvaworld/lib/model/deb/deb.html#larvaworld.lib.model.deb.deb.DEB.update_dict">[docs]</a>    <span class="k">def</span> <span class="nf">update_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dict_values</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">*</span> <span class="mi">24</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ww</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Lw</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hunger</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pupation_buffer</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">deb_p_A</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim_p_A</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">EEB</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_keys</span><span class="p">,</span> <span class="n">dict_values</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gut</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gut</span><span class="o">.</span><span class="n">update_dict</span><span class="p">()</span></div>

<div class="viewcode-block" id="DEB.finalize_dict"><a class="viewcode-back" href="../../../../../content/larvaworld/lib/model/deb/deb.html#larvaworld.lib.model.deb.deb.DEB.finalize_dict">[docs]</a>    <span class="k">def</span> <span class="nf">finalize_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;birth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">birth_time_in_hours</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;pupation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pupation_time_in_hours</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;emergence&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emergence_time_in_hours</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;death&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">death_time_in_hours</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;simulation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;hours_as_larva&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hours_as_larva</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;sim_start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_start</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;epochs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epochs</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;epoch_fs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epoch_fs</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;epoch_qs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epoch_qs</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;fr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;feed_freq_estimate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fr_feed</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;f_mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">])</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;f_deviation_mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gut</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Nfeeds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gut</span><span class="o">.</span><span class="n">Nfeeds</span>
                <span class="n">d</span><span class="p">[</span><span class="s1">&#39;mean_feed_freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gut</span><span class="o">.</span><span class="n">Nfeeds</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">birth_time_in_hours</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
                <span class="n">d</span><span class="p">[</span><span class="s1">&#39;gut_residence_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gut</span><span class="o">.</span><span class="n">residence_time</span>
                <span class="n">d</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gut</span><span class="o">.</span><span class="n">dict</span><span class="p">)</span>
                <span class="c1"># print(self.id, self.gut.Nfeeds, self.intermitter.base_EEB, self.base_hunger)</span>

        <span class="c1"># self.save_dict(path)</span>
        <span class="k">return</span> <span class="n">d</span></div>

<div class="viewcode-block" id="DEB.return_dict"><a class="viewcode-back" href="../../../../../content/larvaworld/lib/model/deb/deb.html#larvaworld.lib.model.deb.deb.DEB.return_dict">[docs]</a>    <span class="k">def</span> <span class="nf">return_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gut</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">gut</span><span class="o">.</span><span class="n">dict</span><span class="p">}</span></div>

<div class="viewcode-block" id="DEB.save_dict"><a class="viewcode-back" href="../../../../../content/larvaworld/lib/model/deb/deb.html#larvaworld.lib.model.deb.deb.DEB.save_dict">[docs]</a>    <span class="k">def</span> <span class="nf">save_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_to</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_to</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span>
                <span class="c1"># raise ValueError (&#39;No path to save DEB dict&#39;)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dict_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">.txt&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gut</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">gut</span><span class="o">.</span><span class="n">dict</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span>
            <span class="n">aux</span><span class="o">.</span><span class="n">save_dict</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_file</span><span class="p">)</span></div>

<div class="viewcode-block" id="DEB.get_p_A"><a class="viewcode-back" href="../../../../../content/larvaworld/lib/model/deb/deb.html#larvaworld.lib.model.deb.deb.DEB.get_p_A">[docs]</a>    <span class="k">def</span> <span class="nf">get_p_A</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">assimilation_mode</span><span class="p">,</span> <span class="n">X_V</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deb_p_A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_Amm_dt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_f</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_p_A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_Amm_dt</span> <span class="o">*</span> <span class="n">f</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span>

        <span class="k">if</span> <span class="n">assimilation_mode</span> <span class="o">==</span> <span class="s1">&#39;sim&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_p_A</span>
        <span class="k">elif</span> <span class="n">assimilation_mode</span> <span class="o">==</span> <span class="s1">&#39;gut&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">gut</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gut</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">X_V</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gut</span><span class="o">.</span><span class="n">p_A</span>
        <span class="k">elif</span> <span class="n">assimilation_mode</span> <span class="o">==</span> <span class="s1">&#39;deb&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">deb_p_A</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">deb_f_mean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ingested_body_mass_ratio</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gut</span><span class="o">.</span><span class="n">ingested_mass</span><span class="p">()</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ww</span> <span class="o">*</span> <span class="mi">100</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ingested_body_volume_ratio</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gut</span><span class="o">.</span><span class="n">ingested_volume</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">*</span> <span class="mi">100</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ingested_gut_volume_ratio</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gut</span><span class="o">.</span><span class="n">ingested_volume</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">gut</span><span class="o">.</span><span class="n">V_gm</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ingested_body_area_ratio</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gut</span><span class="o">.</span><span class="n">ingested_volume</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">amount_absorbed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gut</span><span class="o">.</span><span class="n">absorbed_mass</span><span class="p">(</span><span class="s1">&#39;mg&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">volume_ingested</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gut</span><span class="o">.</span><span class="n">ingested_volume</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">deb_f_deviation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">deb_f_deviation_mean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span></div>


<span class="c1"># p.257 in S. a. L. M. Kooijman, “Dynamic Energy Budget theory for metabolic organisation : Summary of concepts of the third edition,” Water, vol. 365, p. 68, 2010.</span>


<div class="viewcode-block" id="deb_default"><a class="viewcode-back" href="../../../../../content/larvaworld/lib/model/deb/deb.html#larvaworld.lib.model.deb.deb.deb_default">[docs]</a><span class="k">def</span> <span class="nf">deb_default</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;DEB model&#39;</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="p">{},</span> <span class="n">age</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">deb</span> <span class="o">=</span> <span class="n">DEB</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">simulation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_gut</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">epochs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">N</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">epochs</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">Epoch</span><span class="p">()</span><span class="o">.</span><span class="n">nestedConf</span><span class="p">}</span>
    <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">in</span> <span class="n">epochs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">:</span>
        <span class="n">t1</span><span class="o">=</span><span class="n">epochs</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">age_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">t1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">epochs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">N</span><span class="p">:</span> <span class="n">Epoch</span><span class="p">(</span><span class="n">age_range</span><span class="o">=</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span><span class="o">.</span><span class="n">nestedConf</span><span class="p">})</span>
    <span class="k">elif</span> <span class="n">N</span> <span class="o">-</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">epochs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">:</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">epochs</span><span class="p">[</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">age_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">t1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">epochs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">N</span><span class="p">:</span> <span class="n">Epoch</span><span class="p">(</span><span class="n">age_range</span><span class="o">=</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span><span class="o">.</span><span class="n">nestedConf</span><span class="p">})</span>
    <span class="n">deb</span><span class="o">.</span><span class="n">grow_larva</span><span class="p">(</span><span class="n">epochs</span><span class="o">=</span><span class="n">epochs</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="n">age</span><span class="p">)</span>
    <span class="n">deb</span><span class="o">.</span><span class="n">finalize_dict</span><span class="p">()</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">deb</span><span class="o">.</span><span class="n">return_dict</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">d</span></div>

<div class="viewcode-block" id="get_best_EEB"><a class="viewcode-back" href="../../../../../content/larvaworld/lib/model/deb/deb.html#larvaworld.lib.model.deb.deb.get_best_EEB">[docs]</a><span class="k">def</span> <span class="nf">get_best_EEB</span><span class="p">(</span><span class="n">deb</span><span class="p">,</span> <span class="n">cRef</span><span class="p">):</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">cRef</span><span class="p">[</span><span class="s1">&#39;EEB_poly1d&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">deb</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">deb</span><span class="p">[</span><span class="s1">&#39;feed_freq_estimate&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">deb</span><span class="o">.</span><span class="n">fr_feed</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">z</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">a_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">a_max</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="deb_sim"><a class="viewcode-back" href="../../../../../content/larvaworld/lib/model/deb/deb.html#larvaworld.lib.model.deb.deb.deb_sim">[docs]</a><span class="k">def</span> <span class="nf">deb_sim</span><span class="p">(</span><span class="n">refID</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;DEB sim&#39;</span><span class="p">,</span> <span class="n">EEB</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">deb_dt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_hunger</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">model_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">larvaworld.lib.model.modules.intermitter</span> <span class="kn">import</span> <span class="n">OfflineIntermitter</span>
    <span class="n">cRef</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">getRef</span><span class="p">(</span><span class="n">refID</span><span class="p">)</span>
    <span class="n">kws2</span> <span class="o">=</span> <span class="n">cRef</span><span class="p">[</span><span class="s1">&#39;intermitter&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">dt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">kws2</span><span class="p">[</span><span class="s1">&#39;dt&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">kws2</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;dt&#39;</span><span class="p">:</span> <span class="n">dt</span><span class="p">})</span>

    <span class="k">if</span> <span class="n">deb_dt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">deb_dt</span> <span class="o">=</span> <span class="n">dt</span>
    <span class="n">steps_per_day</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">/</span> <span class="n">deb_dt</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">deb</span> <span class="o">=</span> <span class="n">DEB</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">assimilation_mode</span><span class="o">=</span><span class="s1">&#39;gut&#39;</span><span class="p">,</span> <span class="n">save_dict</span><span class="o">=</span><span class="n">save_dict</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">EEB</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">EEB</span> <span class="o">=</span> <span class="n">get_best_EEB</span><span class="p">(</span><span class="n">deb</span><span class="p">,</span> <span class="n">cRef</span><span class="p">)</span>
    <span class="n">deb</span><span class="o">.</span><span class="n">set_steps_per_day</span><span class="p">(</span><span class="n">steps_per_day</span><span class="o">=</span><span class="n">steps_per_day</span><span class="p">)</span>
    <span class="n">deb</span><span class="o">.</span><span class="n">base_hunger</span> <span class="o">=</span> <span class="n">EEB</span>
    <span class="n">Nticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">deb_dt</span> <span class="o">/</span> <span class="n">dt</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">inter</span> <span class="o">=</span> <span class="n">OfflineIntermitter</span><span class="p">(</span><span class="o">**</span><span class="n">kws2</span><span class="p">,</span> <span class="n">EEB</span><span class="o">=</span><span class="n">EEB</span><span class="p">)</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">feeds</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">cum_feeds</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">feed_dict</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">deb</span><span class="o">.</span><span class="n">stage</span> <span class="o">!=</span> <span class="s1">&#39;pupa&#39;</span> <span class="ow">and</span> <span class="n">deb</span><span class="o">.</span><span class="n">alive</span><span class="p">):</span>
        <span class="n">inter</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">inter</span><span class="o">.</span><span class="n">Nfeeds</span> <span class="o">&gt;</span> <span class="n">cum_feeds</span><span class="p">:</span>
            <span class="n">feeds</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">cum_feeds</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">inter</span><span class="o">.</span><span class="n">total_t</span><span class="o">/</span><span class="n">inter</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span> <span class="o">%</span> <span class="n">Nticks</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">feed_dict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feeds</span><span class="p">)</span>
            <span class="n">X_V</span> <span class="o">=</span> <span class="n">deb</span><span class="o">.</span><span class="n">V_bite</span> <span class="o">*</span> <span class="n">deb</span><span class="o">.</span><span class="n">V</span> <span class="o">*</span> <span class="n">feeds</span>
            <span class="n">deb</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">X_V</span><span class="o">=</span><span class="n">X_V</span><span class="p">)</span>
            <span class="n">feeds</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">use_hunger</span><span class="p">:</span>
                <span class="n">inter</span><span class="o">.</span><span class="n">EEB</span> <span class="o">=</span> <span class="n">deb</span><span class="o">.</span><span class="n">hunger</span>
                <span class="c1"># if inter.feeder_reocurrence_as_EEB:</span>
                <span class="c1">#     inter.feeder_reoccurence_rate = inter.EEB</span>
            <span class="k">if</span> <span class="n">deb</span><span class="o">.</span><span class="n">age</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">&gt;</span> <span class="n">counter</span><span class="p">:</span>
                <span class="c1"># print(counter, int(deb.pupation_buffer * 100))</span>
                <span class="n">counter</span> <span class="o">+=</span> <span class="mi">24</span>
    <span class="n">deb</span><span class="o">.</span><span class="n">finalize_dict</span><span class="p">()</span>
    <span class="n">d_sim</span> <span class="o">=</span> <span class="n">deb</span><span class="o">.</span><span class="n">return_dict</span><span class="p">()</span>
    <span class="n">d_inter</span> <span class="o">=</span> <span class="n">inter</span><span class="o">.</span><span class="n">build_dict</span><span class="p">()</span>
    <span class="n">mini_dic</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;DEB model&#39;</span><span class="p">:</span> <span class="n">deb</span><span class="o">.</span><span class="n">species</span><span class="p">,</span>
        <span class="s1">&#39;EEB&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">EEB</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
        <span class="o">**</span><span class="p">{</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">q</span><span class="si">}</span><span class="s1"> ratio&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">d_inter</span><span class="p">[</span><span class="n">nam</span><span class="o">.</span><span class="n">dur_ratio</span><span class="p">(</span><span class="n">p</span><span class="p">)],</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="ow">in</span>
           <span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;stridechain&#39;</span><span class="p">,</span> <span class="s1">&#39;pause&#39;</span><span class="p">,</span> <span class="s1">&#39;feedchain&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;crawl&#39;</span><span class="p">,</span> <span class="s1">&#39;pause&#39;</span><span class="p">,</span> <span class="s1">&#39;feed&#39;</span><span class="p">])},</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">nam</span><span class="o">.</span><span class="n">freq</span><span class="p">(</span><span class="s1">&#39;feed&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_exp&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">inter</span><span class="o">.</span><span class="n">mean_feed_freq</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">nam</span><span class="o">.</span><span class="n">freq</span><span class="p">(</span><span class="s1">&#39;feed&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_est&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">deb</span><span class="o">.</span><span class="n">fr_feed</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">d_sim</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">mini_dic</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">model_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">d_sim</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">d_mod</span> <span class="o">=</span> <span class="n">deb_default</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">model_id</span><span class="p">,</span> <span class="n">save_dict</span><span class="o">=</span><span class="n">save_dict</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d_sim</span><span class="p">,</span> <span class="n">d_mod</span></div>


<span class="k">def</span> <span class="nf">test_substrates</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">substrate_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">q</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">deb0</span> <span class="o">=</span> <span class="n">DEB</span><span class="p">(</span><span class="n">substrate</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;quality&#39;</span><span class="p">:</span> <span class="n">q</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">s</span><span class="p">},</span> <span class="n">assimilation_mode</span><span class="o">=</span><span class="s1">&#39;sim&#39;</span><span class="p">,</span> <span class="n">steps_per_day</span><span class="o">=</span><span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;half-saturation coefficient : &#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">deb0</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="s1">&#39; C-mole/cm**3&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;substrate type : &#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;w_X : &#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">deb0</span><span class="o">.</span><span class="n">substrate</span><span class="o">.</span><span class="n">get_w_X</span><span class="p">()),</span> <span class="s1">&#39;g/C-mole&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;d_X : &#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">deb0</span><span class="o">.</span><span class="n">substrate</span><span class="o">.</span><span class="n">get_d_X</span><span class="p">(</span><span class="n">quality</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="mi">5</span><span class="p">),</span> <span class="s1">&#39;g/cm**3&#39;</span><span class="p">)</span>
            <span class="c1"># print([[q, deb.substrate.get_X(quality=q)] for q in np.arange(0,1.01,0.3)])</span>
            <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="p">[</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">1.00</span><span class="p">]:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;    quality : </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">q</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;          X : </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">deb0</span><span class="o">.</span><span class="n">substrate</span><span class="o">.</span><span class="n">get_X</span><span class="p">(</span><span class="n">quality</span><span class="o">=</span><span class="n">q</span><span class="p">),</span> <span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="s1"> C-mole/cm**3&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;          f : </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">deb0</span><span class="o">.</span><span class="n">substrate</span><span class="o">.</span><span class="n">get_f</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="n">deb0</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="n">quality</span><span class="o">=</span><span class="n">q</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>